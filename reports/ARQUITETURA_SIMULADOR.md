# ğŸ—ï¸ Arquitetura do Simulador Evolution API

## ğŸ“ Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SIMULADOR EVOLUTION API                        â”‚
â”‚                   simulate_evolution_api.py                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CLI Args   â”‚ â”‚  Config JSON â”‚ â”‚  PostgreSQL  â”‚
        â”‚   (argparse) â”‚ â”‚   (JSON)     â”‚ â”‚  (psycopg2)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚              â”‚              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ DatabaseConfig     â”‚
                    â”‚ (dataclass)        â”‚
                    â”‚                    â”‚
                    â”‚ â€¢ host             â”‚
                    â”‚ â€¢ port             â”‚
                    â”‚ â€¢ user             â”‚
                    â”‚ â€¢ password         â”‚
                    â”‚ â€¢ database         â”‚
                    â”‚ â€¢ sslmode          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  EvolutionAPISimulator              â”‚
                    â”‚                                     â”‚
                    â”‚  MÃ©todos:                          â”‚
                    â”‚  â€¢ connect()                       â”‚
                    â”‚  â€¢ fetch_instances()               â”‚
                    â”‚  â€¢ validate_user_permissions()     â”‚
                    â”‚  â€¢ list_database_users()           â”‚
                    â”‚  â€¢ check_current_user_permissions()â”‚
                    â”‚  â€¢ execute_query()                 â”‚
                    â”‚  â€¢ print_summary()                 â”‚
                    â”‚  â€¢ save_report()                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validations  â”‚ â”‚  Instances   â”‚ â”‚   Report     â”‚
        â”‚  (List)      â”‚ â”‚  (List)      â”‚ â”‚   (JSON)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxo de ExecuÃ§Ã£o

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parse CLI Arguments     â”‚
â”‚ â€¢ --server              â”‚
â”‚ â€¢ --database            â”‚
â”‚ â€¢ --validate-all        â”‚
â”‚ â€¢ --list-users          â”‚
â”‚ â€¢ --check-permissions   â”‚
â”‚ â€¢ --verbose             â”‚
â”‚ â€¢ --report              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Config from JSON   â”‚
â”‚ secrets/postgresql_*    â”‚
â”‚ _config.json            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create DatabaseConfig   â”‚
â”‚ object                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create EvolutionAPISimulator    â”‚
â”‚ (with config)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ connect()                       â”‚
â”‚ â”‚ Try psycopg2.connect()       â”‚
â”‚ â”‚ Catch: report error          â”‚
â”‚ â””â”€ return True/False           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”œâ”€ Connection OK?
  â”‚
  â”œâ”€â”€â”€ YES â”€â”€â”
  â”‚          â”‚
  â–¼          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execute Selected Operations:    â”‚ â”‚
â”‚ â€¢ fetch_instances()             â”‚ â”‚
â”‚ â€¢ validate_user_permissions()   â”‚ â”‚
â”‚ â€¢ list_database_users()         â”‚ â”‚
â”‚ â€¢ check_current_user_permissions()
â”‚                                 â”‚ â”‚
â”‚ Store results in:               â”‚ â”‚
â”‚ â€¢ validation_results (List)     â”‚ â”‚
â”‚ â€¢ instances (List)              â”‚ â”‚
â”‚ â€¢ users (List)                  â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ print_summary()      â”‚
        â”‚ Print colored output â”‚
        â”‚ to console           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ --report flag?                 â”‚
  â”‚                                â”‚
  â”œâ”€ YES â”€â”€â” save_report()         â”‚
  â”‚        â””â”€ JSON file            â”‚
  â”‚                                â”‚
  â””â”€ NO â”€â”€â”€â” skip                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”                â”‚
                  â”‚                â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                        END
```

---

## ğŸ“Š Estrutura de Dados

### Input
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLI Arguments & Config           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ --server: wfdb02 / wf004                 â”‚
â”‚ --database: evolution_api_wea001_db      â”‚
â”‚ --validate-all: True/False               â”‚
â”‚ --list-users: True/False                 â”‚
â”‚ --check-permissions: True/False          â”‚
â”‚ --verbose: True/False                    â”‚
â”‚ --report: report_name.json               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Processing
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EvolutionAPISimulator State         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ db_config: DatabaseConfig                â”‚
â”‚ connection: psycopg2.connection          â”‚
â”‚ validation_results: List[AccessValidation]
â”‚ instances: List[InstanceData]            â”‚
â”‚ users: List[Dict]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Output
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Validation Results               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Test Name: "SELECT Instance"           â”‚
â”‚ â€¢ Status: PASS/FAIL                      â”‚
â”‚ â€¢ Duration: 125.43ms                     â”‚
â”‚ â€¢ Details: {"row_count": 15}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Instance Data                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ID: uuid                               â”‚
â”‚ â€¢ Name: minha-instancia                  â”‚
â”‚ â€¢ Status: connected                      â”‚
â”‚ â€¢ Token: instance-token                  â”‚
â”‚ â€¢ Created At: 2025-11-02T10:00:00Z       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JSON Report                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                        â”‚
â”‚   "timestamp": "...",                    â”‚
â”‚   "server": "wfdb02.vya.digital",        â”‚
â”‚   "database": "evolution_api_wea001_db", â”‚
â”‚   "results": [...],                      â”‚
â”‚   "summary": {...}                       â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Banco de Dados

### ConexÃ£o
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL Connection                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Host: wfdb02.vya.digital                        â”‚
â”‚ Port: 5432                                      â”‚
â”‚ Database: evolution_api_wea001_db               â”‚
â”‚ User: migration_user                            â”‚
â”‚ SSL Mode: prefer                                â”‚
â”‚ Connection String:                              â”‚
â”‚ psycopg2://migration_user@wfdb02...             â”‚
â”‚ /evolution_api_wea001_db                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tabelas Consultadas
```
Instance
â”œâ”€ id (UUID)
â”œâ”€ name (VARCHAR)
â”œâ”€ number (VARCHAR)
â”œâ”€ status (VARCHAR)
â”œâ”€ token (VARCHAR) â† Dado SensÃ­vel
â”œâ”€ integration (VARCHAR)
â”œâ”€ clientName (VARCHAR)
â”œâ”€ createdAt (TIMESTAMP)
â””â”€ updatedAt (TIMESTAMP)

Message
â”œâ”€ id (UUID)
â”œâ”€ key (JSONB)
â”œâ”€ messageTimestamp (BIGINT)
â”œâ”€ status (VARCHAR)
â”œâ”€ pushName (VARCHAR)
â”œâ”€ data (JSONB)
â”œâ”€ instanceId (UUID FK)
â””â”€ createdAt (TIMESTAMP)

Settings
â”œâ”€ id (UUID)
â”œâ”€ instanceId (UUID FK)
â”œâ”€ rejectCall (BOOLEAN)
â”œâ”€ msgCall (VARCHAR)
â”œâ”€ groupsIgnored (BOOLEAN)
â””â”€ updatedAt (TIMESTAMP)

OpenaiCreds
â”œâ”€ id (UUID)
â”œâ”€ apiKey (VARCHAR)
â”œâ”€ instanceId (UUID FK)
â””â”€ createdAt (TIMESTAMP)
```

---

## ğŸ” Fluxo de AutenticaÃ§Ã£o & AutorizaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Evolution API Authentication            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Nivel 1: API Key Global                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Header: apikey: GLOBAL_API_KEY   â”‚    â”‚
â”‚ â”‚ âœ“ Acesso: TOTAL ao sistema      â”‚    â”‚
â”‚ â”‚ âœ“ Pode: criar instances, users  â”‚    â”‚
â”‚ â”‚ âœ“ Pode: gerenciar integraÃ§Ãµes   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚ Nivel 2: Instance Token                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Header: apikey: INSTANCE_TOKEN   â”‚    â”‚
â”‚ â”‚ âœ“ Acesso: LIMITED a instÃ¢ncia   â”‚    â”‚
â”‚ â”‚ âœ“ Pode: enviar mensagens         â”‚    â”‚
â”‚ â”‚ âœ“ Pode: buscar histÃ³rico         â”‚    â”‚
â”‚ â”‚ âœ— NÃ£o pode: criar outras instÃ¢ncias
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL Authorization                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ User: migration_user                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ PermissÃµes:                      â”‚    â”‚
â”‚ â”‚ â€¢ SELECT em "Instance"           â”‚    â”‚
â”‚ â”‚ â€¢ SELECT em "Message"            â”‚    â”‚
â”‚ â”‚ â€¢ SELECT em "Settings"           â”‚    â”‚
â”‚ â”‚ â€¢ SELECT em "OpenaiCreds"        â”‚    â”‚
â”‚ â”‚ â€¢ UPDATE em tabelas?             â”‚    â”‚
â”‚ â”‚ â€¢ DELETE em tabelas?             â”‚    â”‚
â”‚ â”‚                                  â”‚    â”‚
â”‚ â”‚ ValidaÃ§Ãµes:                      â”‚    â”‚
â”‚ â”‚ âœ“ Teste 1: SELECT Instance       â”‚    â”‚
â”‚ â”‚ âœ“ Teste 2: SELECT token column   â”‚    â”‚
â”‚ â”‚ âœ“ Teste 3: SELECT Message        â”‚    â”‚
â”‚ â”‚ âœ“ Teste 4: SELECT Settings       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ RelatÃ³rio de ExecuÃ§Ã£o

```json
{
  "execution_summary": {
    "timestamp": "2025-11-02T11:15:31Z",
    "server": "wfdb02.vya.digital",
    "database": "evolution_api_wea001_db",
    "user": "migration_user"
  },

  "connection": {
    "status": "connected",
    "host": "wfdb02.vya.digital",
    "port": 5432,
    "response_time_ms": 125
  },

  "instances": {
    "total_found": 12,
    "sample": [
      {
        "id": "uuid-1",
        "name": "instance-001",
        "status": "connected",
        "integration": "BAILEYS"
      }
    ]
  },

  "validations": {
    "total": 6,
    "passed": 6,
    "failed": 0,
    "success_rate": 100.0,
    "tests": [
      {
        "name": "SELECT Instance",
        "status": "PASS",
        "duration_ms": 125.43
      }
    ]
  },

  "permissions": {
    "user": "migration_user",
    "can_select": true,
    "can_read_sensitive": true,
    "tables_accessible": 3
  }
}
```

---

## ğŸ”„ IntegraÃ§Ã£o com Workflow de MigraÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Enterprise Database Migration Workflow           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚ 1. FIX EVOLUTION PERMISSIONS                      â”‚
â”‚    python3 run_fix_evolution_permissions.py       â”‚
â”‚    --server wfdb02                                â”‚
â”‚    --execute                                      â”‚
â”‚    â””â”€ Resultado: 0/59 privilÃ©gios (BUG)           â”‚
â”‚                                                   â”‚
â”‚ 2. VALIDAR COM SIMULADOR â† NOVO                   â”‚
â”‚    python3 simulate_evolution_api.py              â”‚
â”‚    --server wfdb02                                â”‚
â”‚    --database evolution_api_wea001_db             â”‚
â”‚    --validate-all                                 â”‚
â”‚    â””â”€ Resultado: Gera relatÃ³rio de validaÃ§Ã£o      â”‚
â”‚                                                   â”‚
â”‚ 3. COMPARAR RESULTADOS                            â”‚
â”‚    Antes: PrivilÃ©gios nÃ£o foram aplicados         â”‚
â”‚    Depois: PrivilÃ©gios validados com sucesso      â”‚
â”‚                                                   â”‚
â”‚ 4. GERAR RELATÃ“RIO FINAL                          â”‚
â”‚    Combina resultados de fix + simulador          â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ MÃ©tricas de Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MÃ©trica                   â”‚  Esperado   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tempo de conexÃ£o           â”‚ < 1s        â”‚
â”‚ Busca de instÃ¢ncias        â”‚ < 500ms     â”‚
â”‚ ValidaÃ§Ã£o de permissÃµes    â”‚ < 1s        â”‚
â”‚ Total (--validate-all)     â”‚ < 5s        â”‚
â”‚ GeraÃ§Ã£o de relatÃ³rio       â”‚ < 100ms     â”‚
â”‚ Tamanho relatÃ³rio JSON     â”‚ < 50KB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Checklist de ImplementaÃ§Ã£o

```
Funcionalidade                      â”‚ Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
CLI Argument Parsing                â”‚ âœ…
Config File Loading                 â”‚ âœ…
Database Connection                 â”‚ âœ…
Instance Fetching                   â”‚ âœ…
Permission Validation               â”‚ âœ…
User Listing                        â”‚ âœ…
Current User Permissions            â”‚ âœ…
Error Handling                      â”‚ âœ…
Logging (DEBUG/INFO/WARNING)        â”‚ âœ…
JSON Report Generation              â”‚ âœ…
Documentation                       â”‚ âœ…
Integration with Fix Script         â”‚ âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€
```

---

**VersÃ£o:** 1.0
**Ãšltima AtualizaÃ§Ã£o:** 2 de novembro de 2025
**Status:** âœ… Arquitetura Finalizada
